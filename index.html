<center>
<canvas id=canvas width=800 height=800 style="border:9px solid">
<script>
c=canvas.getContext("2d");

E=R=T=_=s=e=u=d=l=r=0;
onkeydown=onkeyup=z=>top['lurdlRdTl*urEu*_e**s'[(z.which+3)%20]]=z.type[3]<'u'

m=[
0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,
0,0,1,0,0,0,0,0,
0,1,1,0,1,0,2,3,
1,1,1,1,3,1,1,1,
1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,
];

legs = 30;
trunk = 50;
rear = 80;
front = 10;


get = (x, y) => {
  X = Math.floor(x/100);
  Y = Math.floor(y/100);
  return m[Y * 8 + X];
  
}

x = 80;
y = 80;
vy = 0;
gravity = 2;
jump = -10 * gravity;
transx = 10;

setInterval(()=>{

  // Reset
  canvas.width = canvas.width;

  // Draw map
  for(i=0;i<8;i++){
    for(j=0;j<8;j++){
      a=(m[j*8+i]);
      if(a == 1){
        c.fillRect(i*100,j*100,100,100);
      }
      else if(a==2){
        c.fillRect(i*100,j*100+30,50,70);
        c.fillStyle="#fff";
        c.fillRect(i*100+2,j*100+2+30,40,60);
        c.fillStyle="#000";
      }
      else if(a==3){
        c.font="50px a";
        c.save();
        c.translate(i*100-6,j*100+100);
        c.scale(0.93,2.7);
        c.fillText("▲", 0, 0);
        c.fillText("▲", 35,0);
        c.fillText("▲", 70,0);
        c.restore();
        
      }
    }
  }

  // Draw hero
  //c.font="60px a";
  //c.save();
  //c.translate(x, y);
  //c.scale(-1,1);
  c.fillRect(x-rear,y-trunk, rear + front, legs + trunk);
  c.fillStyle="#fff";

//  c.fillText("🏃\ufe0e", 0, 0);
  c.restore(); 
  
  // Gravity (fall)
  if(get(x, y + legs + 10) == 0){ 
    grounded = false;
    vy += gravity;
  }
  
  // Grounded
  else {
    grounded = true;
    vy = 0;
    y = Math.ceil((y+legs) / 100)*100 - legs;
  }
  
  if(y + legs < 0){
    y = trunk;
    vy = gravity;
  }

  if(y + legs > 800){
    y = 800 - legs
    vy = 0;
  }

  if(u && grounded){
    vy = jump;
  }

  if(l && x - rear > 0 && get(x - rear, y) == 0){
     x -= transx;
  }

  if(r && x + front < 800 && get(x + front, y) == 0){
     x += transx;
  }
  
  y += vy;

},33);

</script>
