<center>
<canvas id=canvas width=800 height=800 style="border:9px solid">
<script>

// Global vars
w = .6;
h = .6;

x = 0;
y = 0;

vx = .1;
vy = 0;

gravity = .02;
jump = -10 * gravity;

grounded = false;

c=canvas.getContext("2d");

// Keyboard
E=R=T=_=s=e=u=d=l=r=0;
onkeydown=onkeyup=z=>top['lurdlRdTl*urEu*_e**s'[(z.which+3)%20]]=z.type[3]<'u'

// Map
m=[
0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,
0,0,1,1,0,0,0,0,
0,0,0,1,1,0,2,3,
1,1,1,1,3,1,1,1,
1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,
];

// Get cell value at x:y
get = (x, y) => {
  X = Math.floor(x);
  Y = Math.floor(y);
  return m[Y * 8 + X];
}

// Game loop
setInterval(()=>{

  // Reset
  canvas.width = canvas.width;

  // Draw map
  for(i=0;i<8;i++){
    for(j=0;j<8;j++){
      a=(m[j*8+i]);
      if(a == 1){
        c.fillRect(i*100,j*100,100,100);
      }
      else if(a==2){
        c.fillRect(i*100,j*100+30,50,70);
        c.fillStyle="#fff";
        c.fillRect(i*100+2,j*100+2+30,40,60);
        c.fillStyle="#000";
      }
      else if(a==3){
        c.font="50px a";
        c.save();
        c.translate(i*100-6,j*100+100);
        c.scale(0.93,2.7);
        c.fillText("‚ñ≤", 0, 0);
        c.fillText("‚ñ≤", 35,0);
        c.fillText("‚ñ≤", 70,0);
        c.restore();
        
      }
    }
  }

  // Gravity (fall)
  if(!grounded){//get(x, y + legs + 10) == 0){ 
    //grounded = false;
    vy += gravity;
  }
  
  // Hit ceiling
  if(y < 0){
    y = 0;
    vy = 0;
  }

  // Hit bottom
  if(y + h > 8){
    y = 8 - h
    vy = 0;
    grounded = true;
  }

  // Start jump
  if(u && grounded){
    vy = jump;
    grounded = false;
    console.log(grounded);
  }
  
  // Press left
  if(l){
    x -= vx;
  }

  // Press right
  if(r){
    x += vx;
  }

  // Apply speed to pos
  y += vy;
  
  // Check collisions
  
  // left
  if(x<0){
    x = 0;
  }
  if(x>8){
    x = 8;
  }
  if(l && get(x,y) == 1){
    x=Math.ceil(x);
  }
  // right
  if(r && get(x+w,y) == 1){
    x = Math.floor(x+w) - w;
  }
  
  // Bottom (get grounded)
  if(get(x,y+h) == 1 /*|| get(x+w,y+h) == 1*/){
    grounded = true;
    vy = 0;
    //y = Math.ceil(y) - h;
  }
  // ceil
  if(!grounded && (get(x,y) == 1 /*|| get(x+w,y) == 1*/)){
    vy = 0;
    y = Math.ceil(y);
  }
  
  // Draw hero
  c.fillStyle="#468";
  c.fillRect(x*100,y*100, w*100, h*100);
  //c.font="60px a";
  //c.save();
  //c.translate(x, y);
  //c.scale(-1,1);
  //c.fillText("üèÉ\ufe0e", 0, 0);
  //c.restore(); 

},33);

</script>
